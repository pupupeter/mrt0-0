<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°åŒ—æ·é‹è³‡è¨ŠæŸ¥è©¢</title>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .iframe-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }
        iframe {
            border-radius: 5px;
        }
        #result-container, #route-container, #history-container, #summary-container {
            margin-top: 20px;
            white-space: pre-line;
            text-align: left;
        }
        button {
            padding: 8px 15px;
            cursor: pointer;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>å°åŒ—æ·é‹è³‡è¨ŠæŸ¥è©¢</h1>

        <!-- æ“æ“ åº¦æŸ¥è©¢ -->
        <div class="input-group">
            <input type="text" id="query" placeholder="è«‹è¼¸å…¥æ·é‹ç«™åç¨±æŸ¥è©¢æ“æ“ åº¦" />
            <button onclick="searchCrowded()">æŸ¥è©¢æ“æ“ åº¦</button>
        </div>

        <!-- è·¯ç·šæŸ¥è©¢ -->
        <div class="input-group">
            <input type="text" id="start_station" placeholder="èµ·é»ç«™" />
            <input type="text" id="end_station" placeholder="çµ‚é»ç«™" />
            <button onclick="searchRoute()">æŸ¥è©¢æœ€ä½³è·¯å¾‘</button>
        </div>

        <!-- æŸ¥è©¢ç´€éŒ„åˆ†æ -->
        <div class="input-group">
            <button onclick="fetchHistoryAnalysis()">æŸ¥è©¢ç´€éŒ„åˆ†æ</button>
        </div>

        <!-- è·³è½‰åˆ° 2.html -->
        <div class="input-group">
            <button onclick="window.location.href='/2'">è·³è½‰åˆ° 2.html</button>
        </div>

        <div id="result-container" class="iframe-container"></div>
        <div id="route-container"></div>
        <div id="history-container"></div>

    </div>

    <script>
        function searchCrowded() {
            const query = document.getElementById('query').value;
            const resultContainer = document.getElementById('result-container');
            resultContainer.innerHTML = 'æŸ¥è©¢ä¸­...';

            fetch(`/search?query=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    resultContainer.innerHTML = '';
                    if (data.error) {
                        resultContainer.textContent = data.error;
                    } else {
                        data.forEach(item => {
                            const iframe = document.createElement('iframe');
                            iframe.id = `Taipei-City-Dashboard-Component-${item.id}`;
                            iframe.title = item.title;
                            iframe.src = `https://citydashboard.taipei/embed/${item.id}/taipei`;
                            iframe.width = '450';
                            iframe.height = '400';
                            iframe.style.borderRadius = '5px';
                            iframe.frameBorder = '0';
                            iframe.allow = 'fullscreen';
                            iframe.loading = 'lazy';
                            resultContainer.appendChild(iframe);
                        });
                    }
                })
                .catch(error => {
                    console.error('æŸ¥è©¢éŒ¯èª¤:', error);
                    resultContainer.textContent = 'æŸ¥è©¢ç™¼ç”ŸéŒ¯èª¤';
                });
        }

        function searchRoute() {
            const startStation = document.getElementById('start_station').value;
            const endStation = document.getElementById('end_station').value;
            const routeContainer = document.getElementById('route-container');
            routeContainer.textContent = 'æŸ¥è©¢ä¸­...';

            fetch(`/route?start=${encodeURIComponent(startStation)}&end=${encodeURIComponent(endStation)}`)
                .then(response => response.json())
                .then(data => {
                    routeContainer.innerHTML = '';

                    if (data.error) {
                        routeContainer.textContent = `éŒ¯èª¤ï¼š${data.error}`;
                        return;
                    }

                    const title = document.createElement('h3');
                    title.textContent = `ğŸš‡ å¾ ${data.start} åˆ° ${data.end} çš„å»ºè­°è·¯ç·šï¼š`;
                    routeContainer.appendChild(title);

                    if (data.fastest_route && Array.isArray(data.fastest_route)) {
                        const fastTitle = document.createElement('h4');
                        fastTitle.textContent = 'ğŸ“ æœ€å¿«é€Ÿè·¯ç·šï¼š';
                        routeContainer.appendChild(fastTitle);

                        const fastList = document.createElement('ul');
                        data.fastest_route.forEach(step => {
                            const li = document.createElement('li');
                            li.textContent = step;
                            fastList.appendChild(li);
                        });
                        routeContainer.appendChild(fastList);
                    }

                    if (data.fewest_transfers_route && Array.isArray(data.fewest_transfers_route)) {
                        const fewTitle = document.createElement('h4');
                        fewTitle.textContent = 'ğŸ” æœ€å°‘è½‰ä¹˜è·¯ç·šï¼š';
                        routeContainer.appendChild(fewTitle);

                        const fewList = document.createElement('ul');
                        data.fewest_transfers_route.forEach(step => {
                            const li = document.createElement('li');
                            li.textContent = step;
                            fewList.appendChild(li);
                        });
                        routeContainer.appendChild(fewList);
                    }

                    if ((!data.fastest_route || data.fastest_route.length === 0) &&
                        (!data.fewest_transfers_route || data.fewest_transfers_route.length === 0)) {
                        routeContainer.textContent = 'æœªæ‰¾åˆ°è·¯å¾‘è³‡è¨Šã€‚';
                    }
                })
                .catch(error => {
                    console.error('æŸ¥è©¢è·¯å¾‘éŒ¯èª¤:', error);
                    routeContainer.textContent = 'æŸ¥è©¢è·¯å¾‘ç™¼ç”ŸéŒ¯èª¤';
                });
        }

        function fetchHistoryAnalysis() {
            const historyContainer = document.getElementById('history-container');
            historyContainer.innerHTML = 'æŸ¥è©¢ä¸­...';

            fetch('/history_analysis')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        historyContainer.textContent = `éŒ¯èª¤ï¼š${data.error}`;
                    } else {
                        let html = ` 
                            <h3>ğŸ“Š æŸ¥è©¢ç´€éŒ„çµ±è¨ˆ</h3>
                            <ul>
                                <li>æŸ¥è©¢ç¸½æ¬¡æ•¸ï¼š${data.total_queries}</li>
                                <li>ğŸ” ç†±é–€èµ·é»ç«™ï¼š
                                    <ul>${Object.entries(data.top_start_stations).map(([k, v]) => `<li>${k}ï¼š${v} æ¬¡</li>`).join('')}</ul>
                                </li>
                                <li>ğŸ” ç†±é–€çµ‚é»ç«™ï¼š
                                    <ul>${Object.entries(data.top_end_stations).map(([k, v]) => `<li>${k}ï¼š${v} æ¬¡</li>`).join('')}</ul>
                                </li>
                                <li>ğŸ›¤ï¸ å¸¸è¦‹è·¯ç·šï¼š
                                    <ul>${Object.entries(data.most_frequent_routes).map(([k, v]) => `<li>${k}ï¼š${v} æ¬¡</li>`).join('')}</ul>
                                </li>
                                <li>â° æŸ¥è©¢æ™‚é–“åˆ†ä½ˆï¼ˆå°æ™‚ï¼‰ï¼š
                                    <ul>${Object.entries(data.query_hour_distribution).map(([hour, count]) => `<li>${hour} é»ï¼š${count} æ¬¡</li>`).join('')}</ul>
                                </li>
                            </ul>
                        `;
                        historyContainer.innerHTML = html;
                    }
                })
                .catch(error => {
                    console.error('æŸ¥è©¢ç´€éŒ„éŒ¯èª¤:', error);
                    historyContainer.textContent = 'æŸ¥è©¢ç´€éŒ„ç™¼ç”ŸéŒ¯èª¤';
                });
        }

    </script>

</body>
</html>







